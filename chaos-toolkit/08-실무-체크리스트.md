# 실무 체크리스트

Chaos Toolkit을 실무에 적용할 때 확인해야 할 사항들을 정리합니다.

## 실행 전 체크리스트

### 1. 환경 준비

| 항목 | 확인 사항 | 확인 방법 |
|------|----------|----------|
| **Python 버전** | Python 3.8 이상 설치 여부 확인 | `python3 --version` |
| **Chaos Toolkit** | 설치 및 버전 확인 | `chaos --version` |
| **Kubernetes Extension** | chaostoolkit-kubernetes 설치 여부 | `pip list | grep chaostoolkit-kubernetes` |
| **권한** | Kubernetes 리소스 조작 권한 확인 | `kubectl auth can-i create pods --all-namespaces` |
| **kubeconfig** | Kubernetes 클러스터 연결 확인 | `kubectl cluster-info` |

### 2. 실험 파일 준비

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **문법 검증** | Experiment 파일 문법 검증 | `chaos validate experiment.json` |
| **Steady-State Hypothesis** | 정상 상태 가설 정의 확인 | Probe 정의 및 Tolerance 설정 |
| **Method** | Action 정의 및 순서 확인 | 장애 주입 방법 확인 |
| **Rollback** | Rollback 정의 여부 확인 (필요 시) | 자동 복구 방법 |

### 3. 실행 환경 선택

| 상황 | 권장 방법 | 이유 |
|------|----------|------|
| **운영 클러스터** | 비파괴적 실험만 실행 (Pod 삭제 등) | 서비스 중단 최소화 |
| **테스트 클러스터** | 파괴적 실험 포함 가능 (노드 종료 등) | 전체 검증 가능 |
| **네임스페이스 격리** | 격리된 네임스페이스에서 실행 | 다른 워크로드에 영향 최소화 |

## 실행 중 체크리스트

### 1. 상태 모니터링

| 항목 | 확인 방법 | 비고 |
|------|----------|------|
| **실험 상태** | Journal 파일 확인 (`cat journal.json | jq '.status'`) | 정기적으로 확인 |
| **Steady-State Hypothesis** | Probe 결과 확인 | 실험 전/후 상태 확인 |
| **Action 실행** | Action 실행 결과 확인 | 장애 주입 성공 여부 |
| **로그 확인** | `chaostoolkit.log` 파일 확인 | 오류 발생 여부 확인 |

### 2. 문제 발생 시 대응

| 문제 | 확인 사항 | 대응 방법 |
|------|----------|----------|
| **Steady-State Hypothesis 실패** | Probe 결과 확인 | 실험 중단 또는 Rollback 실행 |
| **Action 실행 실패** | 권한 및 리소스 확인 | 권한 부여 또는 리소스 확보 |
| **Journal 파일 미생성** | Journal 경로 확인 | `--journal-path` 옵션 지정 |
| **Extension 오류** | Extension 설치 확인 | `pip install -U chaostoolkit-kubernetes` |

## 실행 후 체크리스트

### 1. 결과 확인

| 항목 | 확인 방법 | 비고 |
|------|----------|------|
| **Journal 파일** | Journal 파일 구조 확인 | `cat journal.json | jq .` |
| **실험 상태** | Status 확인 (`completed`, `failed`, `aborted`) | 합격 기준 충족 여부 |
| **Steady-State Hypothesis** | `deviated` 필드 확인 | 정상 상태 유지 여부 |
| **Probe 결과** | Probe별 결과 확인 | 실험 전/후 상태 변화 |

### 2. 리포트 생성

| 산출물 | 생성 방법 | 비고 |
|--------|----------|------|
| **Journal 파일** | `chaos run` 실행 시 자동 생성 | `chaos-report.json` 또는 `journal.json` |
| **HTML 리포트** | `chaos report journal.json report.html` | HTML 형식 리포트 |
| **PDF 리포트** | `chaos report journal.json report.pdf --export-format pdf` | PDF 형식 리포트 (선택적) |
| **Markdown 리포트** | `chaos report journal.json report.md --export-format markdown` | Markdown 형식 리포트 |

### 3. 정리

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **Rollback** | Rollback 실행 여부 확인 (필요 시) | 실험 후 자동 복구 |
| **리소스 정리** | 생성된 리소스 정리 확인 | Pod, Deployment 등 |
| **Journal 파일 보관** | Journal 파일 백업 | 추적 및 분석 목적 |

## 운영 환경 적용 체크리스트

### 1. 안전성 확인

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **비파괴적 실험** | 비파괴적 Action만 사용 (Pod 삭제 등) | 운영 환경 권장 |
| **파괴적 실험** | 노드 종료 등 파괴적 Action은 테스트 환경에서만 | 운영 환경 금지 |
| **워크로드 영향** | 기존 워크로드에 영향 없음 확인 | 모니터링 필요 |
| **실행 시간** | 서비스 시간대 고려 | 트래픽 낮은 시간대 실행 |

### 2. 권한 관리

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **최소 권한 원칙** | 필요한 권한만 부여 | RBAC 설정 확인 |
| **ServiceAccount** | ServiceAccount 사용 권장 | 보안 강화 |
| **Namespace 격리** | 격리된 네임스페이스에서 실행 | 다른 워크로드 보호 |

### 3. 모니터링

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **메트릭 수집** | 실험 중 메트릭 수집 (Prometheus 등) | 상태 모니터링 |
| **알림 설정** | Steady-State Hypothesis 실패 시 알림 | 즉시 대응 가능 |
| **로그 저장** | 실험 로그 저장 및 추적 | 분석 및 디버깅 |

## CAT 통합 체크리스트

### 1. 검증 질문(Assertion) 정의

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **검증 질문 명확화** | "장애 상황에서도 정상 동작을 유지하는가?" | Assertion 정의 |
| **합격 기준 수립** | "Steady-State Hypothesis 유지" | 수치/조건 명확화 |
| **예외 처리** | 예외 항목 및 승인 프로세스 정의 | 사전 정의 |

### 2. 기준(Policy) + 절차(Procedure) + 증거(Report)

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **기준 정의** | 합격 기준 문서화 | Policy 문서 |
| **절차 정의** | 실행 방법 문서화 | Procedure 문서 |
| **증거 관리** | Journal 및 리포트 저장 및 추적 | Report 저장소 |

### 3. Gate 역할

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **자동 Gate** | Steady-State Hypothesis 실패 시 배포 차단 | CI/CD 설정 |
| **수동 검토** | 필요한 경우 수동 검토 | 예외 승인 |
| **다음 단계 연결** | CAT 다음 단계로 진행 | 리포트/자동화 |

## 정기 점검 체크리스트

### 주기별 체크리스트

| 주기 | 항목 | 비고 |
|------|------|------|
| **클러스터 배포 시** | Chaos Toolkit 실행 및 합격 확인 | 인수 테스트 |
| **버전 업그레이드 시** | 업그레이드 전/후 복원력 비교 | 호환성 확인 |
| **정기 점검 (월 1회)** | 정기적으로 Chaos Toolkit 실행 | 지속적 검증 |
| **설정 변경 시** | 변경 후 복원력 재검증 | 영향도 확인 |

## 일반적인 문제 해결

### 1. Steady-State Hypothesis 실패

```bash
# Journal 파일에서 실패 원인 확인
cat journal.json | jq '.steady-state-hypothesis'

# Probe 결과 확인
cat journal.json | jq '.steady-state-hypothesis.probes[*]'

# Tolerance 설정 확인
cat experiment.json | jq '.steady-state-hypothesis.probes[].tolerance'
```

### 2. Kubernetes 연결 오류

```bash
# kubeconfig 확인
kubectl config view

# Kubernetes 클러스터 연결 확인
kubectl cluster-info

# 권한 확인
kubectl auth can-i create pods --all-namespaces
```

### 3. Extension 설치 오류

```bash
# Extension 재설치
pip uninstall chaostoolkit-kubernetes
pip install -U chaostoolkit-kubernetes

# 설치된 Extension 확인
pip list | grep chaostoolkit
```

### 4. Journal 파일이 생성되지 않음

```bash
# Journal 경로 확인
chaos run experiment.json --journal-path ./journal.json

# 로그 확인
cat chaostoolkit.log
```

## 관련 문서

- [03-설치및사용법.md](./03-설치및사용법.md) - 설치부터 실행까지 기본 워크플로우
- [06-CAT-활용.md](./06-CAT-활용.md) - CAT 관점에서의 활용
- [09-CICD-통합.md](./09-CICD-통합.md) - CI/CD 파이프라인 통합 가이드
