# Chaos Mesh 구성 요소

Chaos Mesh는 다음 주요 구성 요소로 이루어져 있습니다.

## 아키텍처 개요

```
┌─────────────────────────────────────────────────────────────┐
│                   Chaos Dashboard (UI)                       │
│              웹 기반 실험 관리 및 모니터링                    │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ↓
┌─────────────────────────────────────────────────────────────┐
│         Kubernetes API Server                                │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │   CRDs (Custom Resource Definitions)                 │  │
│  │   - PodChaos, NetworkChaos, IOChaos, etc.            │  │
│  │   - Workflow, Schedule                                │  │
│  └────────────────┬─────────────────────────────────────┘  │
│                   │                                          │
│                   ↓                                          │
│  ┌──────────────────────────────────────────────────────┐  │
│  │   Chaos Controller Manager (Operator)                │  │
│  │   - CRD 감시 및 실험 조율                            │  │
│  │   - Workflow 실행 관리                               │  │
│  └────────────────┬─────────────────────────────────────┘  │
│                   │                                          │
│       ┌───────────┴───────────┐                            │
│       ↓                        ↓                            │
│  ┌──────────┐          ┌──────────────┐                    │
│  │Chaos     │          │Chaos         │                    │
│  │Daemon    │          │Daemon        │                    │
│  │(Node 1)  │          │(Node 2)      │                    │
│  └──────────┘          └──────────────┘                    │
│       │                        │                            │
│       └────────┬───────────────┘                            │
│                ↓                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │   실제 장애 주입 (Pod, Network, I/O 등)              │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 구성 요소 상세

### 1. Chaos Dashboard (UI)

웹 기반 실험 관리 및 모니터링 UI입니다.

| 기능 | 설명 |
|------|------|
| **실험 생성** | 웹 UI를 통한 실험 생성 및 편집 |
| **실험 모니터링** | 실시간 실험 상태 및 결과 확인 |
| **Workflow 관리** | Workflow 생성 및 실행 |
| **RBAC** | 사용자 권한 관리 및 접근 제어 |

**접근 방법:**

```bash
# Port Forward
kubectl port-forward -n chaos-mesh svc/chaos-dashboard 2333:2333

# 브라우저에서 접근
# http://localhost:2333
```

### 2. Chaos Controller Manager (Operator)

Kubernetes Operator로 CRD를 감시하고 실험을 조율합니다.

| 역할 | 설명 |
|------|------|
| **CRD 감시** | Chaos Experiment CRD 생성/수정/삭제 감시 |
| **실험 조율** | Chaos Daemon과 통신하여 실험 실행 |
| **Workflow 실행** | Workflow CRD를 감시하고 단계별 실행 |
| **스케줄링** | Schedule CRD를 감시하고 Cron 기반 실행 |

**위치:**

- `chaos-mesh` 네임스페이스에 배포
- `chaos-controller-manager` Deployment

### 3. Chaos Daemon

각 노드에서 실제 장애를 주입하는 데몬입니다.

| 역할 | 설명 |
|------|------|
| **장애 주입** | Pod, Network, I/O 등 실제 장애 주입 |
| **상태 보고** | 실험 상태 및 결과를 Controller에 보고 |
| **자동 복구** | 실험 종료 시 자동으로 장애 복구 |

**특징:**

- 각 노드에 DaemonSet으로 배포
- 노드 레벨 권한 필요 (프리빌리지드 Pod)
- 네트워크, 파일시스템, 프로세스 등에 접근 가능

### 4. Custom Resource Definitions (CRDs)

Kubernetes CRD로 정의된 실험 타입들입니다.

#### 주요 CRD 타입

| CRD 타입 | 설명 | 용도 |
|---------|------|------|
| **PodChaos** | Pod 장애 시뮬레이션 | Pod 삭제, Container 킬, Pod 실패 |
| **NetworkChaos** | 네트워크 장애 시뮬레이션 | 지연, 손실, 분할, 대역폭 제한 |
| **IOChaos** | I/O 장애 시뮬레이션 | 디스크 I/O 오류, 파일시스템 오류 |
| **StressChaos** | 리소스 스트레스 시뮬레이션 | CPU/메모리 부하 주입 |
| **TimeChaos** | 시간 장애 시뮬레이션 | 시간 조작, 시계 왜곡 |
| **KernelChaos** | 커널 레벨 장애 시뮬레이션 | 시스템 콜 실패, 커널 파라미터 조작 |
| **DNSChaos** | DNS 장애 시뮬레이션 | DNS 쿼리 실패, 응답 조작 |
| **Workflow** | 복합 실험 정의 | 여러 실험을 직렬/병렬로 구성 |
| **Schedule** | 스케줄된 실험 정의 | Cron 기반 반복 실행 |

### 5. Workflow

여러 실험을 직렬/병렬로 구성하여 복합 실험을 실행하는 기능입니다.

| Workflow 타입 | 설명 |
|--------------|------|
| **Serial** | 순차적으로 실행 |
| **Parallel** | 병렬로 실행 |
| **Conditional Branch** | 조건에 따라 분기 |
| **StatusCheck** | 상태 확인 후 다음 단계 진행 |

### 6. Schedule

Cron 기반 반복 실험 실행을 정의하는 CRD입니다.

| 기능 | 설명 |
|------|------|
| **Cron 표현식** | Cron 스타일 스케줄 정의 |
| **실험 템플릿** | 반복 실행할 실험 정의 |
| **실행 이력** | 과거 실행 이력 추적 |

## 실험 실행 흐름

```
1. 사용자가 CRD 생성 (kubectl apply -f experiment.yaml)
   └─ PodChaos, NetworkChaos 등

2. Chaos Controller Manager 감시
   └─ CRD 생성 감지

3. Chaos Controller Manager → Chaos Daemon 통신
   └─ 장애 주입 명령 전달

4. Chaos Daemon이 실제 장애 주입
   └─ Pod 삭제, 네트워크 지연 등

5. 실험 종료 시 자동 복구
   └─ Chaos Daemon이 장애 제거

6. 상태 업데이트
   └─ CRD Status 필드에 실험 상태 기록
```

## 관련 문서

- [03-설치및사용법.md](./03-설치및사용법.md) - 설치부터 실행까지 기본 워크플로우
- [04-실험-정의.md](./04-실험-정의.md) - Chaos Experiment 정의 방법
- [05-워크플로우.md](./05-워크플로우.md) - Workflow 상세 가이드
