# 실무 체크리스트

Chaos Mesh를 실무에 적용할 때 확인해야 할 사항들을 정리합니다.

## 실행 전 체크리스트

### 1. 환경 준비

| 항목 | 확인 사항 | 확인 방법 |
|------|----------|----------|
| **Kubernetes 버전** | Kubernetes 1.16 이상 지원 여부 확인 | `kubectl version --short` |
| **Chaos Mesh 설치** | Chaos Mesh 설치 여부 확인 | `kubectl get pods -n chaos-mesh` |
| **CRD 확인** | Chaos Experiment CRD 확인 | `kubectl get crd | grep chaos-mesh` |
| **권한** | Kubernetes 리소스 조작 권한 확인 | `kubectl auth can-i create podchaos --all-namespaces` |
| **kubeconfig** | Kubernetes 클러스터 연결 확인 | `kubectl cluster-info` |

### 2. 실험 CRD 준비

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **문법 검증** | CRD YAML 문법 검증 | `kubectl apply --dry-run=client -f experiment.yaml` |
| **Selector 설정** | 대상 Pod 선택 설정 확인 | namespaces, labelSelectors 확인 |
| **Duration 설정** | 실험 지속 시간 설정 확인 | 무한 지속 방지 |
| **Mode 설정** | 실험 모드 설정 확인 (one, all, fixed 등) | Blast Radius 제한 |

### 3. 실행 환경 선택

| 상황 | 권장 방법 | 이유 |
|------|----------|------|
| **운영 클러스터** | 비파괴적 실험만 실행 (Pod Kill 등) | 서비스 중단 최소화 |
| **테스트 클러스터** | 파괴적 실험 포함 가능 (Stress, Kernel 등) | 전체 검증 가능 |
| **네임스페이스 격리** | 격리된 네임스페이스에서 실행 | 다른 워크로드에 영향 최소화 |

## 실행 중 체크리스트

### 1. 상태 모니터링

| 항목 | 확인 방법 | 비고 |
|------|----------|------|
| **실험 상태** | `kubectl get podchaos -n default` | 정기적으로 확인 |
| **CRD Status** | `kubectl describe podchaos <name> -n <namespace>` | 실험 상태 상세 확인 |
| **Pod 상태** | `kubectl get pods -l app=test-app -n default` | 대상 Pod 상태 확인 |
| **이벤트 확인** | `kubectl get events -n default` | 실험 관련 이벤트 확인 |

### 2. 문제 발생 시 대응

| 문제 | 확인 사항 | 대응 방법 |
|------|----------|----------|
| **실험이 실행되지 않음** | CRD Status 확인, Controller Manager 로그 확인 | `kubectl logs -n chaos-mesh -l app.kubernetes.io/component=controller-manager` |
| **Chaos Daemon 오류** | Chaos Daemon Pod 상태 확인 | `kubectl get pods -n chaos-mesh | grep chaos-daemon` |
| **권한 오류** | RBAC 설정 확인 | `kubectl auth can-i create podchaos --all-namespaces` |
| **네임스페이스 필터링** | 실험이 의도한 네임스페이스에만 적용되는지 확인 | Selector 설정 확인 |

## 실행 후 체크리스트

### 1. 결과 확인

| 항목 | 확인 방법 | 비고 |
|------|----------|------|
| **실험 상태** | `kubectl get podchaos -n default -o jsonpath='{.status.experiment.phase}'` | phase: Finished 확인 |
| **Pod 상태** | `kubectl get pods -l app=test-app -n default` | 복구 여부 확인 |
| **이벤트 확인** | `kubectl describe podchaos <name> -n <namespace>` | 실험 이벤트 확인 |

### 2. 리포트 생성

| 산출물 | 생성 방법 | 비고 |
|--------|----------|------|
| **CRD YAML** | `kubectl get podchaos <name> -n <namespace> -o yaml` | 실험 정의 및 상태 |
| **이벤트 로그** | `kubectl get events -n <namespace>` | 실험 이벤트 로그 |
| **Dashboard** | Dashboard UI에서 실험 결과 확인 | 시각화 리포트 |

### 3. 정리

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **자동 복구** | 실험 삭제 시 자동으로 장애 복구 확인 | `kubectl delete podchaos <name> -n <namespace>` |
| **리소스 정리** | 생성된 리소스 정리 확인 | CRD 삭제 확인 |
| **CRD 보관** | 실험 CRD YAML 백업 | 추적 및 분석 목적 |

## 운영 환경 적용 체크리스트

### 1. 안전성 확인

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **비파괴적 실험** | 비파괴적 실험만 사용 (Pod Kill 등) | 운영 환경 권장 |
| **파괴적 실험** | Stress, Kernel 등 파괴적 실험은 테스트 환경에서만 | 운영 환경 금지 |
| **워크로드 영향** | 기존 워크로드에 영향 없음 확인 | 모니터링 필요 |
| **실행 시간** | 서비스 시간대 고려 | 트래픽 낮은 시간대 실행 |

### 2. 권한 관리

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **RBAC 설정** | 필요한 권한만 부여 | 최소 권한 원칙 |
| **네임스페이스 필터링** | 격리된 네임스페이스에서 실행 | 다른 워크로드 보호 |
| **Chaos Daemon 권한** | Chaos Daemon의 노드 레벨 권한 확인 | 프리빌리지드 Pod 필요 |

## CAT 통합 체크리스트

### 1. 검증 질문(Assertion) 정의

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **검증 질문 명확화** | "장애 상황에서도 정상 동작을 유지하는가?" | Assertion 정의 |
| **합격 기준 수립** | "실험 완료 (phase: Finished)" | 수치/조건 명확화 |
| **예외 처리** | 예외 항목 및 승인 프로세스 정의 | 사전 정의 |

### 2. 기준(Policy) + 절차(Procedure) + 증거(Report)

| 항목 | 확인 사항 | 비고 |
|------|----------|------|
| **기준 정의** | 합격 기준 문서화 | Policy 문서 |
| **절차 정의** | 실행 방법 문서화 | Procedure 문서 |
| **증거 관리** | CRD YAML 및 리포트 저장 및 추적 | Report 저장소 |

## 정기 점검 체크리스트

| 주기 | 항목 | 비고 |
|------|------|------|
| **클러스터 배포 시** | Chaos Mesh 실행 및 합격 확인 | 인수 테스트 |
| **버전 업그레이드 시** | 업그레이드 전/후 복원력 비교 | 호환성 확인 |
| **정기 점검 (월 1회)** | 정기적으로 Chaos Mesh 실행 | 지속적 검증 |
| **설정 변경 시** | 변경 후 복원력 재검증 | 영향도 확인 |

## 관련 문서

- [03-설치및사용법.md](./03-설치및사용법.md) - 설치부터 실행까지 기본 워크플로우
- [06-CAT-활용.md](./06-CAT-활용.md) - CAT 관점에서의 활용
- [09-CICD-통합.md](./09-CICD-통합.md) - CI/CD 파이프라인 통합 가이드
