# Sonobuoy 실행 모드

Sonobuoy는 다양한 실행 모드를 제공하여 테스트 범위와 목적에 맞게 선택할 수 있습니다.

## 실행 모드 개요

| 모드 | 설명 | 실행 시간 | 운영 환경 적합성 | 활용 시점 |
|------|------|----------|----------------|----------|
| **quick** | 빠른 검증, 소수의 핵심 테스트만 실행 | 5-10분 | ✅ 안전 | 개발/테스트 단계, 빠른 확인 |
| **non-disruptive-conformance** | 파괴적 테스트 제외한 Conformance 테스트 | 1-2시간 | ✅ 안전 | **운영 환경 기본 검증 (권장)** |
| **certified-conformance** | 전체 Conformance 테스트 포함 (disruptive 포함) | 2-4시간 | ⚠️ 주의 필요 | 공식 인증 필요 시 |

## 모드별 상세 설명

### 1. Quick Mode

**목적:** 빠른 검증 및 개발 단계 확인

**특징:**
- 소수의 핵심 테스트만 실행
- 실행 시간이 짧아 빠른 피드백 가능
- 전체 검증에는 부족

**사용 예시:**

```bash
sonobuoy run --mode quick --wait
```

**적합한 상황:**
- 개발 중 빠른 확인
- CI 파이프라인에서 빠른 검증
- 전체 테스트 전 사전 확인

### 2. Non-Disruptive Conformance Mode (권장)

**목적:** 운영 환경에서 안전하게 Conformance 검증

**특징:**
- 파괴적(disruptive) 테스트 제외
- Conformance 테스트의 핵심 부분 실행
- 운영 중 클러스터에서 안전하게 실행 가능
- **CAT 기본 검증에 가장 적합**

**사용 예시:**

```bash
sonobuoy run --mode non-disruptive-conformance --wait
```

**적합한 상황:**
- **운영 클러스터 인수 테스트**
- 클러스터 배포 후 기본 자격 확인
- 정기적인 Conformance 검증
- 서비스 중단 없이 검증 필요 시

**제외되는 테스트:**
- 노드 드레인/코드 테스트
- 쿠버네티스 컴포넌트 재시작 테스트
- 네트워크 파티션 테스트 등

### 3. Certified Conformance Mode

**목적:** CNCF Certified Kubernetes 인증을 위한 완전한 Conformance 테스트

**특징:**
- 모든 Conformance 테스트 포함 (disruptive 포함)
- CNCF 인증 기준에 완전히 부합
- 실행 시간이 길고 리소스 사용량 높음
- **운영 워크로드에 영향 줄 수 있음**

**사용 예시:**

```bash
sonobuoy run --mode certified-conformance --wait
```

**적합한 상황:**
- CNCF Certified Kubernetes 인증 준비
- 클러스터 프로바이더 인증 필요 시
- 테스트 환경에서 전체 검증
- 운영 환경에서는 **사전 계획 하에 실행**

**주의 사항:**
- ⚠️ 운영 워크로드에 영향 가능
- ⚠️ 실행 시간이 길어 일정 계획 필요
- ⚠️ 테스트 환경에서 먼저 실행 권장

## 모드 선택 가이드

### 목적별 선택

| 목적 | 권장 모드 | 이유 |
|------|----------|------|
| **CAT 기본 검증** | `non-disruptive-conformance` | 운영 환경에서 안전하며 충분한 검증 |
| **빠른 확인** | `quick` | 빠른 피드백 필요 시 |
| **공식 인증** | `certified-conformance` | CNCF 인증 준비 시 (테스트 환경) |
| **정기 검증** | `non-disruptive-conformance` | 운영 클러스터 정기 점검 |

### 환경별 선택

| 환경 | 권장 모드 | 이유 |
|------|----------|------|
| **운영 클러스터** | `non-disruptive-conformance` | 서비스 중단 최소화 |
| **스테이징 클러스터** | `non-disruptive-conformance` 또는 `certified-conformance` | 더 강화된 검증 가능 |
| **테스트 클러스터** | `certified-conformance` | 전체 검증 가능 |

## 커스터마이징 옵션

### 테스트 필터링

모드 외에도 특정 테스트만 실행하거나 제외할 수 있습니다:

```bash
# 특정 태그의 테스트만 실행
sonobuoy run --mode non-disruptive-conformance \
  --e2e-focus="\[Conformance\]" \
  --wait

# 특정 테스트 제외
sonobuoy run --mode non-disruptive-conformance \
  --e2e-skip="\[Disruptive\]" \
  --wait
```

### 주요 E2E 테스트 태그

| 태그 | 설명 |
|------|------|
| `[Conformance]` | 공식 Conformance 테스트 |
| `[Disruptive]` | 파괴적 테스트 (노드 재시작 등) |
| `[Serial]` | 순차 실행이 필요한 테스트 |
| `[Slow]` | 실행 시간이 긴 테스트 |
| `[Feature:XXX]` | 특정 기능 관련 테스트 |

## 실무 권장 사항

### CAT 검증 워크플로우

```bash
# 1단계: 빠른 확인 (Quick)
sonobuoy run --mode quick --wait
# → 기본 동작 확인

# 2단계: 기본 검증 (Non-Disruptive Conformance)
sonobuoy run --mode non-disruptive-conformance --wait
# → 운영 환경 기본 자격 확인 (권장)

# 3단계: 전체 검증 (Certified Conformance) - 선택적
# → 테스트 환경에서만 실행
sonobuoy run --mode certified-conformance --wait
```

### 운영 환경 권장 설정

```bash
# 운영 환경 기본 권장 설정
sonobuoy run \
  --mode non-disruptive-conformance \
  --wait \
  --timeout 7200
```

**설명:**
- `--mode non-disruptive-conformance`: 안전한 기본 검증
- `--wait`: 완료까지 대기
- `--timeout 7200`: 타임아웃 2시간 설정

## 관련 문서

- [04-기본사용법.md](./04-기본사용법.md) - 모드 사용 예시
- [06-CAT-활용.md](./06-CAT-활용.md) - CAT에서의 모드 선택
