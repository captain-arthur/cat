# Sonobuoy 테스트 목록 확인 방법

Sonobuoy에서 어떤 테스트가 실행되는지, 테스트 목록을 어떻게 확인하고 지정하는지에 대한 가이드입니다.

## 1. 모드별 실행 테스트 확인 (`sonobuoy gen`)

### Quick 모드

```bash
sonobuoy gen --mode quick | grep -A 5 "E2E_FOCUS"
```

**결과:**
```yaml
- name: E2E_FOCUS
  value: Pods should be submitted and removed
```

**의미:**
- Quick 모드는 **단일 테스트**만 실행
- 테스트: "Pods should be submitted and removed"
- Pod 생성/삭제 기본 동작 검증

### Non-Disruptive Conformance 모드

```bash
sonobuoy gen --mode non-disruptive-conformance | grep -A 5 "E2E_FOCUS\|E2E_SKIP"
```

**결과:**
```yaml
- name: E2E_FOCUS
  value: \[Conformance\]
- name: E2E_SKIP
  value: \[Disruptive\]|NoExecuteTaintManager
```

**의미:**
- Focus: `[Conformance]` 태그가 있는 모든 테스트 실행
- Skip: `[Disruptive]` 태그가 있는 테스트 제외
- Conformance 테스트 중 안전한 것만 실행

### Certified Conformance 모드

```bash
sonobuoy gen --mode certified-conformance | grep -A 5 "E2E_FOCUS\|E2E_SKIP"
```

**결과:**
```yaml
- name: E2E_FOCUS
  value: \[Conformance\]
```

**의미:**
- Focus: `[Conformance]` 태그가 있는 모든 테스트 실행
- Skip: 없음 (Disruptive 테스트도 포함)
- 전체 Conformance 테스트 실행 (CNCF 인증용)

## 2. 전체 매니페스트 확인

특정 모드에서 생성되는 전체 설정을 확인하려면:

```bash
# Quick 모드 설정 확인
sonobuoy gen --mode quick > quick-mode-config.yaml

# Non-disruptive-conformance 모드 설정 확인
sonobuoy gen --mode non-disruptive-conformance > non-disruptive-config.yaml

# Certified-conformance 모드 설정 확인
sonobuoy gen --mode certified-conformance > certified-config.yaml
```

**확인할 항목:**
- `E2E_FOCUS`: 실행할 테스트 필터 (정규식)
- `E2E_SKIP`: 제외할 테스트 필터 (정규식)
- `plugin-name`: 플러그인 종류 (e2e, systemd-logs 등)

## 3. E2E 테스트 태그 목록

Kubernetes E2E 테스트는 태그로 분류됩니다:

| 태그 | 설명 | 예시 테스트 |
|------|------|------------|
| `[Conformance]` | 공식 Conformance 테스트 | Pod 생성, Service 동작 등 |
| `[Disruptive]` | 파괴적 테스트 (노드 재시작 등) | 노드 드레인, 컴포넌트 재시작 |
| `[Serial]` | 순차 실행이 필요한 테스트 | 여러 노드 관련 테스트 |
| `[Slow]` | 실행 시간이 긴 테스트 | 대량 리소스 테스트 |
| `[Feature:XXX]` | 특정 기능 관련 테스트 | `[Feature:Networking]` 등 |
| `[sig-XXX]` | 특정 SIG(Special Interest Group) 관련 | `[sig-network]`, `[sig-storage]` 등 |
| `[NodeConformance]` | 노드 레벨 Conformance 테스트 | 노드에서 실행되는 테스트 |
| `[LinuxOnly]` | Linux 전용 테스트 | Linux 특화 테스트 |

## 4. 커스텀 테스트 필터링 지정

### 특정 태그만 실행

```bash
# Conformance 태그만 실행
sonobuoy run --e2e-focus="\[Conformance\]" --wait

# 네트워크 관련 테스트만 실행
sonobuoy run --e2e-focus="\[sig-network\]" --wait

# 특정 기능 관련 테스트만 실행
sonobuoy run --e2e-focus="\[Feature:Networking\]" --wait
```

### 특정 태그 제외

```bash
# Slow 테스트 제외
sonobuoy run --mode non-disruptive-conformance \
  --e2e-skip="\[Slow\]" --wait

# Disruptive 테스트 제외 (운영 환경)
sonobuoy run --mode non-disruptive-conformance \
  --e2e-skip="\[Disruptive\]" --wait

# 여러 태그 제외
sonobuoy run --mode non-disruptive-conformance \
  --e2e-skip="\[Slow\]|\[Disruptive\]" --wait
```

### 테스트 이름 패턴으로 필터링

```bash
# 특정 테스트 이름 패턴만 실행
sonobuoy run --e2e-focus="should.*Service" --wait

# Pod 관련 테스트만 실행
sonobuoy run --e2e-focus=".*Pod.*" --wait

# 특정 테스트 제외
sonobuoy run --e2e-skip="should.*Delete" --wait
```

## 5. Dry Run으로 테스트 목록 미리 확인

실제 테스트를 실행하지 않고 어떤 테스트가 선택될지 미리 확인:

```bash
# Dry run 모드로 실행 (테스트는 실행하지 않음)
sonobuoy run \
  --plugin-env e2e.E2E_FOCUS="\[Conformance\]" \
  --plugin-env e2e.E2E_SKIP="\[Slow\]" \
  --plugin-env e2e.E2E_DRYRUN=true \
  --wait
```

**주의사항:**
- `E2E_DRYRUN=true` 설정 시 실제 테스트는 실행되지 않음
- 어떤 테스트가 선택되는지만 확인 가능

## 6. 실행 후 결과에서 테스트 목록 확인

실행이 완료된 후 결과 파일에서 실제 실행된 테스트 목록을 확인할 수 있습니다:

```bash
# 결과 다운로드
results=$(sonobuoy retrieve)

# 결과 압축 해제
tar xzf $results

# JUnit XML에서 테스트 목록 확인
find . -name "*.xml" -exec grep -l "testcase" {} \;

# 특정 테스트 이름 확인
grep -r "testcase" plugins/e2e/results/*.xml | head -20
```

## 7. Kubernetes E2E 테스트 문서 참조

Kubernetes E2E 테스트의 전체 목록과 상세 내용은 다음에서 확인할 수 있습니다:

- **Kubernetes 소스 코드**: `test/e2e/` 디렉토리
- **테스트 태그 문서**: Kubernetes 공식 문서
- **실행된 결과 로그**: `e2e.log` 파일에서 테스트 이름 확인

## 8. 실제 확인 예시

### 예시 1: Quick 모드 테스트 확인

```bash
# Quick 모드에서 실행되는 테스트 확인
sonobuoy gen --mode quick | grep -A 2 "E2E_FOCUS"

# 결과:
# - name: E2E_FOCUS
#   value: Pods should be submitted and removed
```

**의미:** Quick 모드는 "Pods should be submitted and removed" 테스트 1개만 실행

### 예시 2: Non-Disruptive Conformance 테스트 범위 확인

```bash
# Non-disruptive-conformance 모드 설정 확인
sonobuoy gen --mode non-disruptive-conformance \
  | grep -E "(E2E_FOCUS|E2E_SKIP)" -A 2

# 결과:
# - name: E2E_FOCUS
#   value: \[Conformance\]
# - name: E2E_SKIP
#   value: \[Disruptive\]|NoExecuteTaintManager
```

**의미:**
- `[Conformance]` 태그가 있는 모든 테스트 실행
- `[Disruptive]` 태그가 있는 테스트는 제외
- NoExecuteTaintManager 관련 테스트도 제외

### 예시 3: 커스텀 필터 확인

```bash
# 커스텀 필터로 설정 생성
sonobuoy gen \
  --e2e-focus="\[Conformance\]" \
  --e2e-skip="\[Slow\]|\[Disruptive\]" \
  | grep -E "(E2E_FOCUS|E2E_SKIP)" -A 2
```

**의미:**
- `[Conformance]` 태그 테스트 중
- `[Slow]` 또는 `[Disruptive]` 태그가 없는 테스트만 실행

## 9. 체크리스트

테스트 실행 전 확인사항:

- [ ] 모드별 실행 테스트 확인 (`sonobuoy gen --mode <mode>`)
- [ ] E2E_FOCUS 값 확인 (어떤 테스트가 실행되는가?)
- [ ] E2E_SKIP 값 확인 (어떤 테스트가 제외되는가?)
- [ ] 필요시 Dry Run으로 테스트 목록 미리 확인
- [ ] 태그 기반 필터링 이해 (Conformance, Disruptive 등)

## 10. 참고 자료

- Sonobuoy 문서: https://sonobuoy.io/docs/
- Kubernetes E2E 테스트: https://github.com/kubernetes/kubernetes/tree/master/test/e2e
- E2E 테스트 태그: Kubernetes 공식 문서
