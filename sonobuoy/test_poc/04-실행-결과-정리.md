# Sonobuoy POC 실행 결과 정리

## 실행 요약

| 항목 | 내용 |
|------|------|
| **실행 일시** | 2026-01-18 17:28:08 |
| **중단 일시** | 2026-01-18 17:40 (예상) |
| **Sonobuoy 버전** | v0.57.4 (CLI) |
| **Sonobuoy 이미지** | sonobuoy/sonobuoy:v0.57.3 |
| **실행 모드** | Quick |
| **클러스터** | Docker Desktop Kubernetes v1.32.2 |

## 실행 결과

### 플러그인별 상태

| 플러그인 | 상태 | 결과 | 설명 |
|---------|------|------|------|
| **e2e** | ✅ **complete** | Passed: 0, Failed: 0, Remaining: 1 | 테스트 완료 |
| **systemd-logs** | ❌ **무한 대기** | - | Docker Desktop 환경 제약 |

### e2e 플러그인 결과

**실행된 테스트:**
- 테스트 이름: `Pods should be submitted and removed`
- 상태: 완료
- 결과: Passed: 0, Failed: 0, Remaining: 1

**의미:**
- Pod 생성/삭제 기본 동작 테스트 완료
- Quick 모드는 단일 테스트만 실행
- 테스트는 정상적으로 완료됨

### systemd-logs 플러그인 문제

**문제점:**
```
chroot: failed to run command 'journalctl': No such file or directory
Plugin is complete. Sleeping indefinitely...
```

**원인:**
- Docker Desktop Kubernetes는 systemd/journalctl을 사용하지 않음
- `journalctl` 명령이 없어서 로그 수집 실패
- 완료 신호(`/tmp/sonobuoy/results/done`)를 생성하지 못해 무한 대기

**worker 컨테이너 상태:**
```
Waiting for waitfile: /tmp/sonobuoy/results/done
Starting to listen on port 8099 for progress updates
```

**결론:**
- Docker Desktop 환경에서는 systemd-logs 플러그인이 정상 작동하지 않음
- production Linux 노드에서는 정상 작동할 것으로 예상

## POC 학습 내용

### 1. Sonobuoy 실행 구조

✅ **확인된 내용:**
- Sonobuoy는 Aggregator Pod + 플러그인 Pod 구조
- Quick 모드는 e2e 플러그인과 systemd-logs 플러그인 실행
- 각 플러그인은 독립적으로 실행됨

### 2. 플러그인 종류

✅ **확인된 플러그인:**
- **e2e 플러그인**: Job 타입, Conformance 테스트 실행
- **systemd-logs 플러그인**: DaemonSet 타입, 각 노드에서 로그 수집

### 3. 테스트 목록 확인 방법

✅ **학습 내용:**
- `sonobuoy gen --mode <mode>` 명령으로 실행할 테스트 확인
- `E2E_FOCUS`, `E2E_SKIP` 환경 변수로 필터링
- Quick 모드: "Pods should be submitted and removed" 테스트 1개만 실행

### 4. 환경 제약사항

⚠️ **Docker Desktop 제약:**
- systemd/journalctl 없음
- systemd-logs 플러그인 작동 불가
- e2e 플러그인은 정상 작동

## 실행 시각화

```
17:28:08 - Sonobuoy 시작
  ├─ sonobuoy 네임스페이스 생성
  ├─ Aggregator Pod 실행
  ├─ e2e Job 실행
  │   └─ "Pods should be submitted and removed" 테스트
  │       └─ ✅ 완료 (17:28:32)
  └─ systemd-logs DaemonSet 실행
      ├─ systemd-logs 컨테이너
      │   ├─ /get_systemd_logs.sh 실행
      │   ├─ ❌ journalctl 명령 없음 (실패)
      │   └─ 무한 대기...
      └─ sonobuoy-worker 컨테이너
          └─ done 파일 대기 중...
```

## 결론

### 성공한 부분

1. ✅ Sonobuoy 설치 및 실행
2. ✅ e2e 플러그인 정상 작동
3. ✅ 테스트 목록 확인 방법 학습
4. ✅ 플러그인 구조 이해

### 제약사항

1. ⚠️ Docker Desktop 환경에서는 systemd-logs 플러그인 작동 불가
2. ⚠️ production 환경(Linux 노드)에서 테스트 필요

### 다음 단계

1. **e2e 플러그인 결과 확인** (완료된 경우)
   - `sonobuoy retrieve` 명령으로 결과 다운로드 시도
   - e2e 테스트 결과만 확인

2. **실제 클러스터에서 테스트**
   - Linux 노드가 있는 실제 클러스터에서 실행
   - 전체 플러그인 정상 작동 확인

3. **Quick 모드 외 모드 테스트**
   - non-disruptive-conformance 모드 테스트
   - 더 많은 테스트 실행 및 결과 확인

## 참고 자료

- 실행 로그: `execution-log.md`
- systemd-logs 상세: `systemd-logs-상세.md`
- 테스트 계획: `01-테스트-계획.md`
- 테스트 목록 확인 방법: `02-테스트-목록-확인방법.md`
