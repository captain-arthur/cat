# kube-burner POC 결과 분석

> **⚠️ 중요:** 이 문서는 **제가 직접 만든 커스텀 테스트**의 결과를 분석한 것입니다.  
> kube-burner의 **공식 시나리오**(cluster-density, node-density 등)와는 다릅니다.  
> 목적: kube-burner의 기본 동작 방식과 결과 리포팅 방식을 이해하기 위한 POC입니다.

## 실행 요약

| 항목 | 결과 |
|------|------|
| **실행 상태** | ✅ 성공 |
| **실행 시간** | 약 3초 (Pre-load 1분 제외) |
| **생성된 네임스페이스** | 10개 (kube-burner-test-0 ~ kube-burner-test-9) |
| **생성된 Pod** | 10개 (각 네임스페이스당 1개) |
| **실행 UUID** | 38aa0c0b-dfad-4592-b10e-afd51d5f1f43 |

## 핵심 질문에 대한 답변

### 1. 어떤 성능을 테스트했는가?

**현재 실행:**
- **기본 리소스 생성 테스트**: Pod 생성 동작 확인
- **반복 실행 테스트**: 10번 반복 실행
- **자동 정리 테스트**: 리소스 정리 동작 확인

**미수집 메트릭 (Prometheus 필요):**
- Pod latency (Pod 생성 → Ready 시간)
- API latency (API Server 응답 시간)
- etcd latency (etcd 응답 시간)
- Resource usage (CPU/메모리 사용량)

**의미:**
- Prometheus 없이도 기본 리소스 생성/삭제 동작 확인 가능
- 성능 메트릭은 Prometheus 필요

### 2. 어떤 방식으로 테스트했는가?

**테스트 방식:**

1. **Pre-load 단계** (약 1분)
   - 이미지 Pull을 위한 DaemonSet 생성
   - 모든 노드에서 이미지 준비
   - `preload-kube-burner` 네임스페이스에 DaemonSet 생성

2. **Job 실행 단계** (약 3초)
   - 설정 파일의 `jobIterations: 10`만큼 반복
   - 각 iteration마다:
     - 네임스페이스 생성 (`kube-burner-test-{iteration}`)
     - Pod 생성 (각 네임스페이스당 1개)
     - 완료 대기 (Pod Ready 상태 확인)

3. **완료 확인 단계**
   - 생성된 오브젝트 검증
   - 리소스 정리 (실행 완료 후)

**특징:**
- **반복 실행**: `jobIterations` 설정만큼 반복
- **네임스페이스별 실행**: 각 iteration마다 별도 네임스페이스 사용
- **자동 완료 대기**: Pod Ready 상태까지 대기
- **자동 정리**: 실행 완료 후 리소스 정리

### 3. 결과를 어떻게 리포팅하는가?

**콘솔 출력:**
```
🔥 Starting kube-burner
1/10 iterations completed
...
10/10 iterations completed
Job simple-pod-test took 3s
Finished execution with UUID: 38aa0c0b-dfad-4592-b10e-afd51d5f1f43
👋 Exiting kube-burner
```

**로그 파일:**
- `kube-burner-{UUID}.log`: 실행 로그 저장
- 상세한 실행 과정 기록

**리포트 파일 (Prometheus 있을 때):**
- `reports/metrics.json`: 수집된 메트릭 데이터 (Pod latency, API latency 등)
- `reports/thresholds.json`: Threshold 검증 결과 (Pass/Fail)
- `reports/index.json`: 인덱스 정보

**현재 상태:**
- Prometheus 없어서 리포트 파일(`reports/`) 미생성
- 콘솔 로그와 로그 파일(`kube-burner-*.log`)로만 결과 확인

### 4. 무엇을 기준으로 통과/실패를 판단하는가?

**현재 실행 (Prometheus 없음):**
- **리소스 생성 성공 여부**: Pod 정상 생성 확인
- **실행 완료 여부**: 에러 없이 완료 확인
- **자동 정리 여부**: 리소스 정리 확인

**Threshold 검증 (Prometheus 있을 때):**

**설정 파일 예시:**
```yaml
thresholds:
- metricName: podLatency
  operator: ">="
  value: 5000  # 5초 초과 시 실패

- metricName: apiLatencyP95
  operator: ">="
  value: 100  # 100ms 초과 시 실패
```

**Pass/Fail 판단:**
- Threshold 위반 시 Fail
- 모든 iteration 완료 시 Pass (에러 없이)
- 결과는 `reports/thresholds.json`에 저장

## 실행 흐름 시각화

```
18:07:04 - kube-burner 시작
  ├─ Pre-load 단계 (1분)
  │   └─ DaemonSet 생성 → 이미지 Pull → 정리
  │
  ├─ Job 실행 단계 (3초)
  │   ├─ iteration 1: kube-burner-test-0 네임스페이스 + Pod 생성
  │   ├─ iteration 2: kube-burner-test-1 네임스페이스 + Pod 생성
  │   ├─ ...
  │   └─ iteration 10: kube-burner-test-9 네임스페이스 + Pod 생성
  │
  └─ 완료 확인 및 정리
      ├─ 오브젝트 검증
      └─ 리소스 정리
```

## 주요 관찰 사항

### 1. 네임스페이스 자동 생성

**확인된 동작:**
- 설정 파일: `namespace: kube-burner-test`
- 실제 생성: `kube-burner-test-0`, `kube-burner-test-1`, ... `kube-burner-test-9`
- 각 iteration마다 별도 네임스페이스 자동 생성

**의미:**
- 네임스페이스 격리로 각 iteration 독립 실행
- 여러 iteration을 동시에 실행 가능

### 2. 자동 완료 대기

**확인된 동작:**
- Pod 생성 후 Ready 상태까지 자동 대기
- 각 네임스페이스별로 완료 확인
- 최대 4시간 타임아웃

**의미:**
- Pod가 실제로 Ready 상태가 될 때까지 대기
- 실제 워크로드 배포 시뮬레이션

### 3. 자동 정리

**확인된 동작:**
- 실행 완료 후 리소스 정리
- 네임스페이스와 Pod 자동 삭제

**주의사항:**
- 일부 네임스페이스가 남아있을 수 있음 (정리 시간 차이)
- 수동 정리 필요 시: `kube-burner destroy -c <config>` 또는 `kubectl delete namespace kube-burner-test-*`

### 4. Pre-load 단계

**확인된 동작:**
- 실행 전 이미지 Pull을 위한 Pre-load
- DaemonSet을 생성하여 모든 노드에서 이미지 준비
- 약 1분 소요

**의미:**
- 이미지 Pull 시간을 측정에서 제외
- 실제 성능 측정의 정확도 향상

## Prometheus 없이 확인 가능한 것

**확인 가능:**
- ✅ 리소스 생성 성공 여부
- ✅ 실행 완료 여부
- ✅ 실행 시간 (Job took 3s)
- ✅ 자동 정리 동작

**확인 불가:**
- ❌ Pod latency (메트릭 수집 필요)
- ❌ API latency (메트릭 수집 필요)
- ❌ Resource usage (메트릭 수집 필요)
- ❌ Threshold 검증 (메트릭 필요)

## Prometheus 있을 때 추가로 확인 가능한 것

**추가 확인 가능:**
- ✅ Pod latency (p50, p95, p99)
- ✅ API latency (p50, p95, p99)
- ✅ Resource usage (CPU, 메모리)
- ✅ Threshold 검증 (Pass/Fail)

**리포트 파일:**
- `reports/metrics.json`: 수집된 메트릭 데이터
- `reports/thresholds.json`: Threshold 검증 결과
- `reports/index.json`: 인덱스 정보

## 결론

### 성공한 부분

1. ✅ kube-burner 설치 및 실행
2. ✅ 기본 리소스 생성/삭제 동작 확인
3. ✅ 반복 실행 및 자동 정리 동작 확인
4. ✅ 실행 로그 파일 생성 확인

### 확인된 제약사항

1. ⚠️ Prometheus 없어서 성능 메트릭 수집 불가
2. ⚠️ 리포트 파일(`reports/`) 미생성 (메트릭 필요)

### 다음 단계

1. **Prometheus 설치 후 메트릭 수집 테스트**
   - Pod latency, API latency 등 측정
   - Threshold 검증

2. **결과 리포트 확인**
   - `reports/metrics.json` 분석
   - `reports/thresholds.json` 확인

3. **더 복잡한 워크로드 테스트**
   - cluster-density 시나리오
   - node-density 시나리오

## 참고 자료

- 실행 로그: `execution-log.md`
- 실행 결과: `02-실행-결과.md`
- 로그 파일: `kube-burner-38aa0c0b-dfad-4592-b10e-afd51d5f1f43.log`
