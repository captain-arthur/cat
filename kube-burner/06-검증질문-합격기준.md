# 검증 질문(Assertion) 및 합격 기준

kube-burner를 사용하여 검증할 수 있는 **검증 질문(Assertion)**과 **합격 기준**을 정의합니다.

## 검증 질문(Assertion) 정의 원칙

### 핵심 원칙

**"도구"가 아니라 "검증 질문(Assertion)"으로 카테고리를 고정**

- 도구는 경계가 모호하다
- 같은 도구라도 질문이 다르면 다른 카테고리에 넣어도 된다
- 필요하다면 "Primary 카테고리 1개 + Secondary 태그"로 운영

### "그래서 우리는 뭘 통과하면 이 클러스터를 운영 승인할 수 있는가?"

- **기준(Policy)**: 수치/조건으로 명확히 정의
- **절차(Procedure)**: 검증 실행 방법
- **증거(Report)**: 결과 리포트 산출물

## kube-burner 관련 검증 질문(Assertion)

### 1. 성능 검증

#### Assertion 1.1: "클러스터가 요구 성능 수준을 만족하는가?"

| 항목 | 내용 |
|------|------|
| **검증 질문** | "클러스터가 요구 성능 수준을 만족하는가?" |
| **테스트 방법** | `kube-burner init -c cluster-density.yml` |
| **합격 기준** | **p95 API latency < X ms** (예: 100ms) |
| **실행 환경** | 테스트 환경 또는 운영 환경 |
| **비고** | 컨트롤 플레인 성능 검증 |

**실행 명령어:**

```bash
kube-burner init -c cluster-density.yml \
  --prometheus-url http://prometheus:9090
```

**합격 판단:**

```bash
# p95 API latency 확인
p95_latency=$(cat reports/metrics.json | jq '.apiLatency.p95')

# 합격 기준: 100ms 미만
if [ $(echo "$p95_latency >= 100" | bc) -eq 1 ]; then
  echo "❌ p95 API latency 초과: $p95_latency ms"
  exit 1
fi
```

#### Assertion 1.2: "Pod Ready 시간이 요구 수준인가?"

| 항목 | 내용 |
|------|------|
| **검증 질문** | "Pod Ready 시간이 요구 수준인가?" |
| **테스트 방법** | `kube-burner init -c node-density.yml` |
| **합격 기준** | **Pod Ready 시간 < Y 초** (예: 5초) |
| **실행 환경** | 테스트 환경 또는 운영 환경 |
| **비고** | 워크로드 배포 성능 검증 |

### 2. 수용량 검증

#### Assertion 2.1: "최대 수용량이 요구 수준인가?"

| 항목 | 내용 |
|------|------|
| **검증 질문** | "노드당 최대 파드 수가 요구 수준인가?" |
| **테스트 방법** | `kube-burner init -c node-density.yml` |
| **합격 기준** | **노드당 최대 N Pod 배포 가능** (예: 100 Pod) |
| **비고** | 수용량 확인 |

### 3. 확장성 검증

#### Assertion 3.1: "컨트롤 플레인 병목 없이 확장 가능한가?"

| 항목 | 내용 |
|------|------|
| **검증 질문** | "컨트롤 플레인 병목 없이 확장 가능한가?" |
| **테스트 방법** | `kube-burner init -c cluster-density.yml` |
| **합격 기준** | **etcd latency < Z ms** (예: 50ms) |
| **비고** | 확장성 확인 |

## 합격 기준 정의

### 기본 합격 기준 (권장)

| 검증 항목 | 합격 기준 | 비고 |
|----------|----------|------|
| **p95 API latency** | < 100ms | 컨트롤 플레인 성능 |
| **Pod Ready 시간** | < 5초 | 워크로드 배포 성능 |
| **etcd latency** | < 50ms | 확장성 확인 |
| **노드당 최대 Pod** | ≥ 100 Pod | 수용량 확인 |

### 임계치(Threshold) 설정 예시

```yaml
# threshold 설정 예시
thresholds:
- metricName: podLatency
  operator: ">="
  value: 5000  # 5초 초과 시 실패

- metricName: apiLatencyP95
  operator: ">="
  value: 100  # 100ms 초과 시 실패
```

## CAT 전체 흐름에서의 위치

### CAT 단계별 검증 질문

| 단계 | 카테고리 | 검증 질문(Assertion) | 도구 | 합격 기준 |
|------|---------|---------------------|------|----------|
| 1 | Conformance/Config | "클러스터가 공식 Conformance를 만족하는가?" | Sonobuoy | Non-disruptive Conformance 100% 통과 |
| 2 | Security | "보안 설정이 CIS 기준을 만족하는가?" | kube-bench | High/Critical 0건 |
| **3** | **Performance/Scale** | **"성능이 요구 수준인가?"** | **kube-burner** | **p95 API latency < X ms** |
| 4 | Resilience | "장애 복구가 요구 시간 내인가?" | LitmusChaos | RTO < X분 |
| 5 | Automation | "검증이 자동화되었는가?" | CI/CD | 자동 실행 및 리포트 생성 |

### Gate 역할

```bash
# CAT 3단계: kube-burner 성능 검증
kube-burner init -c cluster-density.yml --prometheus-url http://prometheus:9090

# Threshold 검증
if [ $(cat reports/thresholds.json | jq '.failed') -gt 0 ]; then
  echo "❌ CAT 3단계 실패: kube-burner 성능 검증 실패"
  exit 1
fi

echo "✅ CAT 3단계 통과: kube-burner 성능 검증 성공"
# → 다음 단계 진행 (LitmusChaos)
```

## 관련 문서

- [05-CAT-활용.md](./05-CAT-활용.md) - CAT 관점에서의 kube-burner 활용
- [04-워크로드-시나리오.md](./04-워크로드-시나리오.md) - 워크로드별 합격 기준
