# kube-burner 설치 및 사용법

kube-burner를 설치하고 실행하여 결과를 확인하는 전체 워크플로우를 설명합니다.

## 설치

### Go로 설치 (권장)

```bash
# Go 환경 필요 (Go 1.18 이상)
go install github.com/cloud-bulldozer/kube-burner@latest

# PATH에 추가 (필요 시)
export PATH=$PATH:$(go env GOPATH)/bin

# 설치 확인
kube-burner version
```

### 바이너리 다운로드

```bash
# 최신 버전 확인: https://github.com/cloud-bulldozer/kube-burner/releases

# Linux
wget https://github.com/cloud-bulldozer/kube-burner/releases/download/v2.2.0/kube-burner-2.2.0-Linux-x86_64.tar.gz
tar xzf kube-burner-2.2.0-Linux-x86_64.tar.gz
sudo mv kube-burner /usr/local/bin/

# macOS
wget https://github.com/cloud-bulldozer/kube-burner/releases/download/v2.2.0/kube-burner-2.2.0-Darwin-x86_64.tar.gz
tar xzf kube-burner-2.2.0-Darwin-x86_64.tar.gz
sudo mv kube-burner /usr/local/bin/
```

### 설치 확인

```bash
kube-burner version
```

## 기본 워크플로우

### 1. 설정 파일 준비

워크로드 시나리오 설정 파일을 준비합니다.

```yaml
# cluster-density.yaml 예시
jobs:
- name: cluster-density
  namespace: kube-burner-density
  jobIterations: 100
  objects:
  - objectTemplate: pod.yml
    replicas: 10

measurements:
- name: podLatency
  esIndex: kube-burner-density

prometheus:
  url: http://prometheus-k8s.monitoring.svc:9090
```

### 2. 워크로드 실행

```bash
# 기본 실행
kube-burner init -c cluster-density.yaml

# Prometheus URL 지정
kube-burner init -c cluster-density.yaml --prometheus-url http://prometheus:9090

# 타임스탬프 지정
kube-burner init -c cluster-density.yaml \
  --start-time 2024-01-18T10:00:00Z \
  --end-time 2024-01-18T11:00:00Z
```

**옵션 설명:**

| 옵션 | 설명 | 필수 여부 |
|------|------|----------|
| `-c, --config` | 설정 파일 경로 | 필수 |
| `--prometheus-url` | Prometheus URL | 선택 (설정 파일에 있으면 생략 가능) |
| `--start-time` | 테스트 시작 시간 | 선택 |
| `--end-time` | 테스트 종료 시간 | 선택 |

### 3. 결과 확인

```bash
# 결과 파일 확인
ls -la reports/

# 결과 파일 위치
# - reports/metrics.json: 메트릭 데이터
# - reports/index.json: 인덱스 정보
```

**생성되는 파일:**

| 파일 | 설명 |
|------|------|
| `reports/metrics.json` | 수집된 메트릭 데이터 |
| `reports/index.json` | 인덱스 정보 |
| `reports/thresholds.json` | Threshold 검증 결과 |

### 4. 결과 분석

```bash
# JSON 파일 확인
cat reports/metrics.json | jq .

# Threshold 검증 결과 확인
cat reports/thresholds.json | jq .
```

### 5. 리소스 정리

```bash
# 생성된 리소스 정리
kube-burner destroy -c cluster-density.yaml

# 또는 직접 네임스페이스 삭제
kubectl delete namespace kube-burner-density
```

## 고급 사용법

### Prometheus 메트릭 프로필 사용

```bash
# 메트릭 프로필 지정
kube-burner init -c cluster-density.yaml \
  --metrics-profile metrics-profile.yaml
```

### 결과 인덱싱 (Elasticsearch/OpenSearch)

```bash
# 결과를 Elasticsearch에 저장
kube-burner index -c cluster-density.yaml \
  --es-server http://elasticsearch:9200 \
  --es-index kube-burner-results
```

### 여러 Prometheus 인스턴스 사용

```yaml
# 설정 파일에서 여러 Prometheus 정의
prometheus:
  - url: http://prometheus-1:9090
  - url: http://prometheus-2:9090
```

## 실전 예시

### 예시 1: 기본 클러스터 밀도 테스트

```bash
# 1. 설정 파일 다운로드 (예시)
wget https://raw.githubusercontent.com/cloud-bulldozer/kube-burner/main/examples/cluster-density/cluster-density.yml

# 2. 워크로드 실행
kube-burner init -c cluster-density.yml --prometheus-url http://prometheus:9090

# 3. 결과 확인
cat reports/metrics.json | jq '.podLatency.p95'

# 4. 정리
kube-burner destroy -c cluster-density.yml
```

### 예시 2: 노드 밀도 테스트

```bash
# 노드 밀도 시나리오 실행
kube-burner init -c node-density.yml --prometheus-url http://prometheus:9090

# 결과 확인
cat reports/thresholds.json
```

## 문제 해결

### 일반적인 문제

#### 1. Prometheus 연결 오류

```bash
# Prometheus URL 확인
curl http://prometheus:9090/api/v1/query?query=up

# 설정 파일에서 Prometheus URL 확인
cat cluster-density.yml | grep prometheus
```

#### 2. 권한 오류

```bash
# 필요한 권한 확인
kubectl auth can-i create pods --all-namespaces
kubectl auth can-i create namespaces

# ServiceAccount 생성 (필요 시)
kubectl create serviceaccount kube-burner -n default
kubectl create clusterrolebinding kube-burner-admin \
  --clusterrole=cluster-admin \
  --serviceaccount=default:kube-burner
```

#### 3. 리소스 부족

```bash
# 클러스터 리소스 확인
kubectl top nodes
kubectl describe nodes

# 설정 파일에서 jobIterations 조정
# jobIterations: 100 → 50
```

## 관련 문서

- [04-워크로드-시나리오.md](./04-워크로드-시나리오.md) - 워크로드 시나리오 상세
- [07-실무-체크리스트.md](./07-실무-체크리스트.md) - 실무 적용 시 확인 사항
