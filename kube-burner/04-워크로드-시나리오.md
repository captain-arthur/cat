# kube-burner 워크로드 시나리오

kube-burner에서 제공하는 사전 정의된 워크로드 시나리오를 설명합니다.

## 워크로드 시나리오 개요

kube-burner는 다양한 목적의 워크로드 시나리오를 제공합니다.

| 워크로드 | 목적 | 검증 항목 |
|---------|------|----------|
| **cluster-density** | 컨트롤 플레인 성능 테스트 | API latency, etcd 성능, 리소스 밀도 |
| **node-density** | 노드별 파드 밀도 테스트 | 노드당 파드 수, kubelet 성능 |
| **networkpolicy** | 네트워크 정책 오버헤드 테스트 | NetworkPolicy 적용 후 성능 |
| **crd-scale** | CRD 스케일 성능 테스트 | CRD 수 증가 시 API 성능 |

## 주요 워크로드 상세

### 1. cluster-density / cluster-density-v2

**목적:** 클러스터 전역 리소스 밀도 테스트

| 항목 | 설명 |
|------|------|
| **목적** | 컨트롤 플레인 성능 및 확장성 테스트 |
| **실행 방식** | 다양한 리소스(Pod, Deployment, Service, ConfigMap 등)를 다양한 조합으로 반복 생성 |
| **검증 항목** | - API Server latency<br>- etcd 성능<br>- 스케줄러 성능<br>- 리소스 생성/삭제 시간 |

**특징:**
- 클러스터 전체 리소스 밀도를 높여 테스트
- 여러 네임스페이스, Deployment, Service 등을 생성
- 컨트롤 플레인 부하를 집중적으로 테스트

**사용 시점:**
- 컨트롤 플레인 성능 검증 필요 시
- 대규모 리소스 환경에서의 성능 확인

### 2. node-density / node-density-cni / node-density-heavy

**목적:** 노드별 파드 밀도 테스트

| 항목 | 설명 |
|------|------|
| **목적** | 노드당 많은 파드를 배포했을 때 각 구성 요소 처리 능력 파악 |
| **실행 방식** | 각 노드에 많은 파드 배포 (pause 이미지 등) |
| **검증 항목** | - Pod 생성 지연 시간<br>- kubelet CPU/메모리<br>- CNI 성능 (node-density-cni) |

**버전별 차이:**

| 워크로드 | 특징 |
|---------|------|
| **node-density** | 기본 노드 밀도 테스트 |
| **node-density-cni** | CNI 특화 테스트 (네트워크 오버헤드) |
| **node-density-heavy** | 데이터베이스 등 무거운 워크로드 포함 |

**사용 시점:**
- 노드별 최대 파드 수 확인
- kubelet/CNI 성능 검증

### 3. networkpolicy (multitenant, matchlabels, matchexpressions)

**목적:** 네트워크 정책 오버헤드 테스트

| 항목 | 설명 |
|------|------|
| **목적** | NetworkPolicy 적용 시 네트워크 성능 영향 측정 |
| **실행 방식** | NetworkPolicy를 적용한 상태에서 통신 테스트 |
| **검증 항목** | - NetworkPolicy 적용 후 통신 지연<br>- 네트워크 정책 오버헤드<br>- CNI 정책 엔진 성능 |

**버전별 차이:**

| 워크로드 | 특징 |
|---------|------|
| **networkpolicy-multitenant** | 멀티테넌트 환경 테스트 |
| **networkpolicy-matchlabels** | Label 기반 정책 테스트 |
| **networkpolicy-matchexpressions** | Expression 기반 정책 테스트 |

**사용 시점:**
- NetworkPolicy 사용 시 성능 영향 확인
- 멀티테넌트 환경 성능 검증

### 4. crd-scale

**목적:** CRD 스케일 성능 테스트

| 항목 | 설명 |
|------|------|
| **목적** | CRD 수가 많을 때 API 서버 및 컨트롤러 성능 영향 측정 |
| **실행 방식** | 많은 수의 CRD 및 CR(Custom Resource) 생성 |
| **검증 항목** | - CRD 생성/조회 latency<br>- API Server 확장성<br>- 컨트롤러 성능 |

**사용 시점:**
- CRD를 많이 사용하는 환경
- Operator 기반 환경 성능 검증

### 5. cluster-density-ms (경량 버전)

**목적:** cluster-density의 경량 버전

| 항목 | 설명 |
|------|------|
| **목적** | cluster-density 계열의 경량 버전 |
| **실행 방식** | 작지만 비슷한 유형의 리소스 적용/생성 |
| **특징** | 빠른 테스트, 적은 리소스 사용 |

**사용 시점:**
- 빠른 성능 확인이 필요한 경우
- 리소스 제약 환경

## 워크로드 선택 가이드

### 목적별 선택

| 목적 | 권장 워크로드 | 이유 |
|------|------------|------|
| **컨트롤 플레인 성능** | cluster-density | 다양한 리소스로 컨트롤 플레인 부하 테스트 |
| **노드 성능** | node-density | 노드별 파드 밀도 확인 |
| **네트워크 정책 오버헤드** | networkpolicy | NetworkPolicy 적용 시 성능 영향 |
| **CRD 스케일** | crd-scale | CRD 환경 성능 검증 |
| **빠른 확인** | cluster-density-ms | 경량 버전으로 빠른 테스트 |

### 환경별 선택

| 환경 | 권장 워크로드 | 이유 |
|------|------------|------|
| **운영 클러스터** | cluster-density-ms | 적은 리소스 사용으로 안전한 테스트 |
| **테스트 클러스터** | cluster-density | 전체 성능 검증 |
| **네트워크 정책 사용** | networkpolicy | 정책 오버헤드 확인 |
| **Operator 환경** | crd-scale | CRD 성능 검증 |

## 실행 예시

### cluster-density 실행

```bash
# 설정 파일 다운로드
wget https://raw.githubusercontent.com/cloud-bulldozer/kube-burner/main/examples/cluster-density/cluster-density.yml

# 워크로드 실행
kube-burner init -c cluster-density.yml --prometheus-url http://prometheus:9090

# 결과 확인
cat reports/metrics.json | jq '.podLatency'
```

### node-density 실행

```bash
# node-density 시나리오 실행
kube-burner init -c node-density.yml --prometheus-url http://prometheus:9090
```

## 관련 문서

- [05-CAT-활용.md](./05-CAT-활용.md) - CAT 관점에서의 워크로드 활용
- [06-검증질문-합격기준.md](./06-검증질문-합격기준.md) - 워크로드별 합격 기준
