# kube-burner 구성 요소

kube-burner는 다음 주요 구성 요소로 이루어져 있습니다.

## 아키텍처 개요

```
┌─────────────────┐
│  kube-burner CLI│  ← 사용자가 실행하는 명령어 도구
└────────┬────────┘
         │ kubectl/API
         ↓
┌─────────────────────────────────────────────┐
│         Kubernetes Cluster                  │
│                                             │
│  ┌──────────────────────────────────────┐  │
│  │   리소스 생성/삭제/패치                │  │
│  │   - Pod, Deployment, Namespace 등     │  │
│  └──────────────────────────────────────┘  │
│                                             │
│  ┌──────────────────────────────────────┐  │
│  │   Prometheus (메트릭 수집)            │  │
│  │   - Pod latency                      │  │
│  │   - API latency                      │  │
│  │   - Resource usage                   │  │
│  └──────────────────────────────────────┘  │
│                                             │
│  ┌──────────────────────────────────────┐  │
│  │   결과 수집 및 분석                   │  │
│  │   - 성능 지표 (p50, p95, p99)        │  │
│  │   - Threshold 검증                   │  │
│  │   - 리포트 생성                      │  │
│  └──────────────────────────────────────┘  │
└─────────────────────────────────────────────┘
```

## 구성 요소 상세

### 1. CLI 유틸리티

커맨드라인에서 실행하는 클라이언트 도구입니다.

| 명령어 | 기능 | 설명 |
|--------|------|------|
| `kube-burner init` | 워크로드 실행 | 설정 파일 기반 워크로드 실행 |
| `kube-burner destroy` | 리소스 정리 | 생성된 리소스 삭제 |
| `kube-burner index` | 결과 인덱싱 | 결과를 Elasticsearch/OpenSearch에 저장 |

**설치 방법:**

```bash
# Go로 설치
go install github.com/cloud-bulldozer/kube-burner@latest

# 바이너리 다운로드
# https://github.com/cloud-bulldozer/kube-burner/releases
```

### 2. 워크로드 설정 파일

YAML 형식의 설정 파일로 워크로드를 정의합니다.

**주요 구성:**

| 섹션 | 설명 |
|------|------|
| **jobs** | 실행할 작업 목록 (리소스 생성/삭제 등) |
| **measurements** | 수집할 메트릭 정의 |
| **prometheus** | Prometheus 연결 설정 |
| **thresholds** | Pass/Fail 기준 (임계치) |

**예시:**
```yaml
jobs:
- name: cluster-density
  namespace: kube-burner-density
  jobIterations: 100
  objects:
  - objectTemplate: pod.yml
    replicas: 10

measurements:
- name: podLatency
  esIndex: kube-burner-density

prometheus:
  url: http://prometheus-k8s.monitoring.svc:9090

thresholds:
- metricName: podLatency
  operator: ">="
  value: 5000
```

### 3. 워크로드 시나리오

사전 정의된 워크로드 시나리오를 제공합니다.

| 워크로드 | 설명 |
|---------|------|
| **cluster-density** | 클러스터 전역 리소스 밀도 테스트 |
| **node-density** | 노드별 파드 밀도 테스트 |
| **networkpolicy** | 네트워크 정책 오버헤드 테스트 |
| **crd-scale** | CRD 스케일 성능 테스트 |

자세한 내용은 [04-워크로드-시나리오.md](./04-워크로드-시나리오.md) 참조.

### 4. Measurements (메트릭 수집)

성능 지표를 수집하고 분석합니다.

| 측정 항목 | 설명 |
|----------|------|
| **Pod Latency** | Pod 생성 → Ready까지 시간 |
| **API Latency** | API Server 응답 시간 |
| **Resource Usage** | CPU/메모리 사용량 |
| **Scheduler Latency** | 스케줄링 지연 시간 |

### 5. Prometheus 통합

Prometheus와 연계하여 메트릭을 수집합니다.

| 기능 | 설명 |
|------|------|
| **메트릭 쿼리** | PromQL을 사용하여 메트릭 조회 |
| **타임스탬프 매칭** | 테스트 실행 시간대 메트릭 수집 |
| **다중 Prometheus** | 여러 Prometheus 인스턴스 지원 |

## 실행 흐름

```bash
# 1. 사용자가 CLI 명령 실행
kube-burner init -c cluster-density.yaml

# 2. CLI가 설정 파일 파싱
kube-burner → YAML 파싱 → jobs, measurements, prometheus 확인

# 3. 리소스 생성 (반복)
kube-burner → Kubernetes API 호출
             → Pod/Deployment/Namespace 생성
             → 반복 (jobIterations만큼)

# 4. 메트릭 수집
kube-burner → Prometheus 쿼리
             → Pod latency, API latency 등 수집

# 5. 결과 분석
kube-burner → 통계 계산 (p50, p95, p99)
             → Threshold 검증
             → 리포트 생성

# 6. 리소스 정리
kube-burner destroy -c cluster-density.yaml
```

## 관련 문서

- [03-설치및사용법.md](./03-설치및사용법.md) - 기본 사용법 및 실행 흐름
- [04-워크로드-시나리오.md](./04-워크로드-시나리오.md) - 워크로드 시나리오 상세
