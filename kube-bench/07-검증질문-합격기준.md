# 검증 질문(Assertion) 및 합격 기준

kube-bench를 사용하여 검증할 수 있는 **검증 질문(Assertion)**과 **합격 기준**을 정의합니다.

## 검증 질문(Assertion) 정의 원칙

### 핵심 원칙

**"도구"가 아니라 "검증 질문(Assertion)"으로 카테고리를 고정**

- 도구는 경계가 모호하다
- 같은 도구라도 질문이 다르면 다른 카테고리에 넣어도 된다
- 필요하다면 "Primary 카테고리 1개 + Secondary 태그"로 운영

## kube-bench 관련 검증 질문(Assertion)

### 1. CIS Benchmark 검증

#### Assertion 1.1: "클러스터 보안 설정이 CIS 기준을 만족하는가?"

| 항목 | 내용 |
|------|------|
| **검증 질문** | "클러스터 보안 설정이 CIS 기준을 만족하는가?" |
| **테스트 방법** | CIS Benchmark 검사 → FAIL 항목 확인 |
| **합격 기준** | **FAIL 항목 0건 (또는 허용 범위 내)** |
| **실행 환경** | 테스트/운영 환경 |
| **비고** | **보안 설정 확인 필수 항목** |

**합격 판단:**

```bash
# FAIL 항목 확인
FAIL_COUNT=$(cat master-results.json | jq '[.Controls[] | select(.result == "FAIL")] | length')

if [ "$FAIL_COUNT" -gt 0 ]; then
  echo "❌ CIS Benchmark 검증 실패: 운영 승인 불가"
  exit 1
fi
```

### 2. 마스터 노드 검증

#### Assertion 2.1: "마스터 노드 보안 설정이 적절한가?"

| 항목 | 내용 |
|------|------|
| **검증 질문** | "마스터 노드 보안 설정이 적절한가?" |
| **테스트 방법** | 마스터 노드 검사 → FAIL 항목 확인 |
| **합격 기준** | **마스터 노드 FAIL 항목 0건** |
| **비고** | **Control Plane 보안 확인** |

### 3. 워커 노드 검증

#### Assertion 3.1: "워커 노드 보안 설정이 적절한가?"

| 항목 | 내용 |
|------|------|
| **검증 질문** | "워커 노드 보안 설정이 적절한가?" |
| **테스트 방법** | 워커 노드 검사 → FAIL 항목 확인 |
| **합격 기준** | **워커 노드 FAIL 항목 0건** |
| **비고** | **Worker Node 보안 확인** |

## 합격 기준 정의

### 기본 합격 기준 (권장)

| 검증 항목 | 합격 기준 | 비고 |
|----------|----------|------|
| **CIS Benchmark** | FAIL 항목 0건 (또는 허용 범위 내) | 보안 설정 확인 |
| **마스터 노드** | 마스터 노드 FAIL 항목 0건 | Control Plane 보안 확인 |
| **워커 노드** | 워커 노드 FAIL 항목 0건 | Worker Node 보안 확인 |

### 검사 결과 기반 합격 기준

| 결과 | 의미 | 합격 여부 |
|------|------|----------|
| `PASS` | 검사 항목 통과 | ✅ 합격 |
| `FAIL` | 검사 항목 실패 | ❌ 불합격 |
| `WARN` | 경고 항목 | ⚠️ 검토 필요 |
| `INFO` | 정보 제공 항목 | ℹ️ 참고용 |

## CAT 전체 흐름에서의 위치

### CAT 단계별 검증 질문

| 단계 | 카테고리 | 검증 질문(Assertion) | 도구 | 합격 기준 |
|------|---------|---------------------|------|----------|
| 1 | Conformance/Config | "클러스터가 공식 Conformance를 만족하는가?" | Sonobuoy | Non-disruptive Conformance 100% 통과 |
| **2** | **Security** | **"보안 설정이 CIS 기준을 만족하는가?"** | **kube-bench** | **FAIL 항목 0건 (또는 허용 범위 내)** |
| 3 | Performance/Scale | "성능이 요구 수준인가?" | kube-burner | p95 API latency < X ms |
| 4 | Resilience/Fault Tolerance | "장애 상황에서도 정상 동작을 유지하는가?" | Chaos Mesh | 실험 완료 (phase: Finished) |
| 5 | Automation | "검증이 자동화되었는가?" | CI/CD | 자동 실행 및 리포트 생성 |

## 관련 문서

- [06-CAT-활용.md](./06-CAT-활용.md) - CAT 관점에서의 kube-bench 활용
- [08-실무-체크리스트.md](./08-실무-체크리스트.md) - 실무 적용 시 확인 사항
