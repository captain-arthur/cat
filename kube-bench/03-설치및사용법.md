# kube-bench 설치 및 사용법

kube-bench를 설치하고 실행하여 결과를 확인하는 전체 워크플로우를 설명합니다.

## 설치

### 바이너리 다운로드 (권장)

```bash
# Linux
curl -L https://github.com/aquasecurity/kube-bench/releases/latest/download/kube-bench_0.6.15_linux_amd64.tar.gz -o kube-bench.tar.gz
tar -xvf kube-bench.tar.gz
sudo mv kube-bench /usr/local/bin/

# 설치 확인
kube-bench version
```

### 패키지 설치

```bash
# Debian/Ubuntu
curl -L https://github.com/aquasecurity/kube-bench/releases/latest/download/kube-bench_0.6.15_linux_amd64.deb -o kube-bench.deb
sudo dpkg -i kube-bench.deb

# RHEL/CentOS
curl -L https://github.com/aquasecurity/kube-bench/releases/latest/download/kube-bench_0.6.15_linux_amd64.rpm -o kube-bench.rpm
sudo rpm -i kube-bench.rpm
```

### 컨테이너로 실행

```bash
# Docker로 실행
docker run --rm -v /etc:/etc:ro -v /var:/var:ro -it --pid=host aquasec/kube-bench:latest run --targets master
```

## 기본 워크플로우

### 1. 마스터 노드 검사

```bash
# Control Plane 검사
kube-bench run --targets master

# 특정 컴포넌트만 검사
kube-bench run --targets master --components etcd
```

### 2. 워커 노드 검사

```bash
# 워커 노드 검사
kube-bench run --targets node

# kubelet만 검사
kube-bench run --targets node --components kubelet
```

### 3. JSON 형식으로 출력

```bash
# JSON 형식으로 저장
kube-bench run --targets master --json --output results.json

# JUnit XML 형식으로 저장
kube-bench run --targets master --junit --output results.xml
```

### 4. Kubernetes Job으로 실행

```bash
# Job YAML 생성 및 실행
kubectl apply -f job.yaml

# CronJob으로 주기적 실행
kubectl apply -f cronjob.yaml
```

## 실전 예시

### 예시 1: 기본 보안 검사

```bash
# 1. 마스터 노드 검사
kube-bench run --targets master

# 2. 워커 노드 검사
kube-bench run --targets node

# 3. 결과를 JSON으로 저장
kube-bench run --targets master --json --output master-results.json
```

### 예시 2: Kubernetes Job으로 실행

**job.yaml:**

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: kube-bench-master
spec:
  template:
    spec:
      hostPID: true
      containers:
      - name: kube-bench
        image: aquasec/kube-bench:latest
        command: ["kube-bench", "run", "--targets", "master"]
        volumeMounts:
        - name: var-lib-etcd
          mountPath: /var/lib/etcd
          readOnly: true
        - name: etc-systemd
          mountPath: /etc/systemd
          readOnly: true
      volumes:
      - name: var-lib-etcd
        hostPath:
          path: /var/lib/etcd
      - name: etc-systemd
        hostPath:
          path: /etc/systemd
      restartPolicy: Never
```

**실행:**

```bash
kubectl apply -f job.yaml
kubectl logs job/kube-bench-master
```

## 관련 문서

- [04-검사-항목.md](./04-검사-항목.md) - 검사 항목 및 방법 상세 가이드
- [05-출력-리포트.md](./05-출력-리포트.md) - 출력 형식 및 리포트 해석
- [08-실무-체크리스트.md](./08-실무-체크리스트.md) - 실무 적용 시 확인 사항
