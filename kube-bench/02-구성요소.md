# kube-bench 구성 요소

kube-bench는 다음 주요 구성 요소로 이루어져 있습니다.

## 아키텍처 개요

### CLI 모드

```
┌─────────────────┐
│  kube-bench CLI │  ← 사용자가 실행하는 명령어 도구
└────────┬────────┘
         │
         ↓
┌─────────────────────────────────────────────┐
│         Kubernetes Cluster                  │
│                                             │
│  ┌──────────────────────────────────────┐  │
│  │   마스터 노드 검사                    │  │
│  │   - Control Plane 검사               │  │
│  │   - etcd 검사                        │  │
│  └──────────────────────────────────────┘  │
│                                             │
│  ┌──────────────────────────────────────┐  │
│  │   워커 노드 검사                      │  │
│  │   - kubelet 검사                     │  │
│  │   - kube-proxy 검사                  │  │
│  └──────────────────────────────────────┘  │
└─────────────────────────────────────────────┘
         │
         ↓
┌─────────────────────────────────────────────┐
│         결과 리포트 (PASS/FAIL/WARN/INFO)   │
└─────────────────────────────────────────────┘
```

### Kubernetes Job 모드

```
┌─────────────────────────────────────────────────────────────┐
│              Kubernetes Job / CronJob                       │
│         주기적 보안 검사 수행                               │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ↓
┌─────────────────────────────────────────────────────────────┐
│         Kubernetes Cluster                                  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │   마스터/워커 노드 검사                               │  │
│  │   - CIS Benchmark 기반 검사                          │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 구성 요소 상세

### 1. CLI 유틸리티

커맨드라인에서 실행하는 검사 도구입니다.

| 명령어 | 기능 | 설명 |
|--------|------|------|
| `kube-bench run` | 검사 실행 | 마스터/워커 노드 검사 실행 |
| `kube-bench master` | 마스터 노드 검사 | Control Plane, etcd 검사 |
| `kube-bench node` | 워커 노드 검사 | kubelet, kube-proxy 검사 |

### 2. CIS Benchmark 정의 파일 (YAML)

Kubernetes 버전과 CIS Benchmark 버전 간 매핑 및 검사 항목 정의입니다.

| 구성 요소 | 설명 |
|----------|------|
| **버전 매핑** | Kubernetes 버전 → CIS Benchmark 버전 매핑 |
| **검사 항목** | 마스터/워커 노드별 검사 항목 정의 |
| **권고 사항** | 실패 항목에 대한 수정 권고 제공 |

### 3. 자동 버전 감지

Kubernetes 버전을 자동으로 감지하여 적절한 CIS Benchmark 버전을 선택합니다.

| 기능 | 설명 |
|------|------|
| **버전 감지** | Kubernetes 버전 자동 감지 |
| **Benchmark 매핑** | 감지된 버전에 맞는 CIS Benchmark 선택 |
| **검사 항목 선택** | 버전별 검사 항목 자동 선택 |

### 4. 노드 유형 감지

마스터/워커 노드 유형을 자동으로 감지하여 해당 검사만 수행합니다.

| 노드 유형 | 검사 항목 |
|----------|----------|
| **Master/Control Plane** | API Server, Scheduler, Controller Manager, etcd |
| **Worker Node** | kubelet, kube-proxy |
| **etcd** | etcd 설정 검사 |

### 5. 리포트 생성

PASS/FAIL/WARN/INFO 결과 및 권고(remediation)를 제공합니다.

| 리포트 형식 | 설명 |
|-----------|------|
| **stdout** | 터미널 표준 출력 |
| **JSON** | JSON 형식 리포트 |
| **JUnit XML** | JUnit XML 형식 (CI/CD 통합용) |

## 검사 실행 흐름

```
1. 사용자가 검사 명령 실행
   └─ kube-bench run --targets master

2. Kubernetes 버전 감지
   └─ 자동 버전 감지 → CIS Benchmark 버전 선택

3. 노드 유형 감지
   └─ 마스터/워커 노드 유형 자동 감지

4. CIS Benchmark 기반 검사
   └─ 각 검사 항목별 보안 설정 검증

5. 결과 리포트 생성
   └─ PASS/FAIL/WARN/INFO 결과 및 권고 제공
```

## 관련 문서

- [03-설치및사용법.md](./03-설치및사용법.md) - 설치부터 실행까지 기본 워크플로우
- [04-검사-항목.md](./04-검사-항목.md) - 검사 항목 및 방법
- [05-출력-리포트.md](./05-출력-리포트.md) - 출력 형식 및 리포트 해석
