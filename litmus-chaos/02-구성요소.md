# LitmusChaos 구성 요소

LitmusChaos는 다음 주요 구성 요소로 이루어져 있습니다.

## 아키텍처 개요

```
┌─────────────────────────────────────────────────────────────┐
│              ChaosCenter / Portal (UI)                      │
│         웹 기반 실험 관리 및 모니터링                         │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ↓
┌─────────────────────────────────────────────────────────────┐
│         Kubernetes API Server                                │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │   CRDs (Custom Resource Definitions)                 │  │
│  │   - ChaosExperiment                                   │  │
│  │   - ChaosEngine                                       │  │
│  │   - ChaosResult                                       │  │
│  │   - ChaosWorkflow                                     │  │
│  └────────────────┬─────────────────────────────────────┘  │
│                   │                                          │
│                   ↓                                          │
│  ┌──────────────────────────────────────────────────────┐  │
│  │   Chaos Operator                                      │  │
│  │   - CRD 감시 및 실험 조율                            │  │
│  │   - Workflow 실행 관리                               │  │
│  └────────────────┬─────────────────────────────────────┘  │
│                   │                                          │
│                   ↓                                          │
│  ┌──────────────────────────────────────────────────────┐  │
│  │   Chaos Runner / Experiment Pod                      │  │
│  │   - 실제 장애 주입 수행                              │  │
│  │   - Probes 실행 및 검증                              │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 구성 요소 상세

### 1. ChaosCenter / Portal

웹 기반 실험 관리 및 모니터링 UI입니다.

| 기능 | 설명 |
|------|------|
| **실험 생성** | 웹 UI를 통한 실험 생성 및 편집 |
| **실험 모니터링** | 실시간 실험 상태 및 결과 확인 |
| **ChaosHub 통합** | ChaosHub에서 실험 템플릿 가져오기 |
| **Probe 관리** | Probe 정의 및 실행 결과 확인 |

**접근 방법:**

```bash
# Port Forward
kubectl port-forward -n litmus svc/litmusportal-frontend 9091:9091

# 브라우저에서 접근
# http://localhost:9091
```

### 2. Chaos Operator

Kubernetes Operator로 CRD를 감시하고 실험을 조율합니다.

| 역할 | 설명 |
|------|------|
| **CRD 감시** | ChaosExperiment, ChaosEngine CRD 감시 |
| **실험 조율** | ChaosRunner Pod 생성 및 실행 |
| **Workflow 실행** | ChaosWorkflow CRD를 감시하고 단계별 실행 |
| **결과 수집** | ChaosResult CRD에 실험 결과 기록 |

**위치:**

- `litmus` 네임스페이스에 배포
- `chaos-operator` Deployment

### 3. ChaosHub

실험 템플릿 저장소입니다.

| 기능 | 설명 |
|------|------|
| **템플릿 저장소** | 다양한 Chaos 실험 템플릿 제공 |
| **템플릿 가져오기** | ChaosHub에서 실험 템플릿 가져오기 |
| **커스터마이징** | 템플릿 수정 및 재사용 |

### 4. Probes

Steady State 검증을 위한 Probe 타입들입니다.

| Probe 타입 | 설명 |
|-----------|------|
| **HTTP Probe** | HTTP 엔드포인트 응답 확인 |
| **Prometheus Probe** | Prometheus 메트릭 확인 |
| **Command Probe** | 커맨드 실행 결과 확인 |
| **K8s Probe** | Kubernetes 리소스 상태 확인 |

### 5. Custom Resource Definitions (CRDs)

Kubernetes CRD로 정의된 실험 타입들입니다.

| CRD 타입 | 설명 | 용도 |
|---------|------|------|
| **ChaosExperiment** | 실험 템플릿 정의 | 실험 파라미터 및 스텝 정의 |
| **ChaosEngine** | 실험 실행 정의 | 대상 애플리케이션, Probes 설정 |
| **ChaosResult** | 실험 결과 기록 | verdict, 상태, Probe 결과 |
| **ChaosWorkflow** | 복합 실험 정의 | 여러 실험을 직렬/병렬로 구성 |

## 실험 실행 흐름

```
1. ChaosExperiment 생성 (템플릿 정의)
   └─ ChaosHub에서 가져오거나 직접 정의

2. ChaosEngine 생성 (실험 실행)
   └─ 대상 애플리케이션, Probes 설정

3. Chaos Operator 감시
   └─ ChaosEngine CRD 생성 감지

4. Chaos Runner Pod 생성
   └─ 실제 장애 주입 및 Probes 실행

5. ChaosResult 업데이트
   └─ 실험 결과 및 verdict 기록

6. 자동 정리
   └─ 실험 종료 시 Pod 자동 정리
```

## 관련 문서

- [03-설치및사용법.md](./03-설치및사용법.md) - 설치부터 실행까지 기본 워크플로우
- [04-실험-정의.md](./04-실험-정의.md) - Chaos Experiment 정의 방법
- [05-워크플로우.md](./05-워크플로우.md) - Workflow 상세 가이드
