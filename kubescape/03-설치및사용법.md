# Kubescape 설치 및 사용법

Kubescape를 설치하고 실행하여 결과를 확인하는 전체 워크플로우를 설명합니다.

## 설치

### 스크립트로 설치 (권장)

```bash
# Linux/macOS
curl -s https://raw.githubusercontent.com/kubescape/kubescape/master/install.sh | /bin/bash

# 설치 확인
kubescape version
```

### Homebrew로 설치 (macOS)

```bash
brew install kubescape
```

### 수동 설치

```bash
# Linux
wget https://github.com/kubescape/kubescape/releases/latest/download/kubescape-ubuntu-latest

# macOS
wget https://github.com/kubescape/kubescape/releases/latest/download/kubescape-macos-latest

# 실행 권한 부여
chmod +x kubescape-ubuntu-latest
sudo mv kubescape-ubuntu-latest /usr/local/bin/kubescape
```

## 기본 워크플로우

### 1. 프레임워크 스캔

```bash
# NSA-CISA 프레임워크 스캔
kubescape scan framework nsa

# CIS Benchmark 스캔
kubescape scan framework cis

# MITRE ATT&CK 프레임워크 스캔
kubescape scan framework mitre

# 모든 프레임워크 스캔
kubescape scan framework all
```

### 2. 클러스터 스캔

```bash
# 현재 클러스터 스캔
kubescape scan

# 호스트 스캔 포함
kubescape scan --enable-host-scan

# 특정 네임스페이스만 스캔
kubescape scan --include-namespaces default,production
```

### 3. Manifest 파일 스캔

```bash
# YAML 파일 스캔
kubescape scan nginx-deployment.yaml

# 디렉토리 스캔
kubescape scan ./manifests/

# Helm 차트 스캔
kubescape scan ./helm-chart/
```

### 4. 이미지 스캔

```bash
# 이미지 취약점 스캔
kubescape scan image nginx:latest

# 여러 이미지 스캔
kubescape scan image nginx:latest redis:7-alpine
```

### 5. 결과 확인

```bash
# JSON 형식으로 저장
kubescape scan framework nsa --format json --output results.json

# JUnit XML 형식으로 저장
kubescape scan framework nsa --format junit --output results.xml

# HTML 리포트 생성
kubescape scan framework nsa --format html --output report.html
```

## 실전 예시

### 예시 1: 기본 보안 스캔

```bash
# 1. NSA-CISA 프레임워크 스캔
kubescape scan framework nsa

# 2. 결과를 JSON으로 저장
kubescape scan framework nsa --format json --output nsa-scan.json

# 3. 결과 확인
cat nsa-scan.json | jq '.summary'
```

### 예시 2: CIS Benchmark 스캔

```bash
# CIS Benchmark 스캔
kubescape scan framework cis --format json --output cis-scan.json

# 통과 비율 확인
cat cis-scan.json | jq '.summary.score'
```

### 예시 3: 이미지 취약점 스캔

```bash
# 이미지 취약점 스캔
kubescape scan image nginx:latest --format json --output image-scan.json

# Critical 취약점 확인
cat image-scan.json | jq '.vulnerabilities[] | select(.severity == "Critical")'
```

## 고급 사용법

### Compliance Threshold 설정

```bash
# 80% 이상 통과해야 합격
kubescape scan framework nsa --compliance-threshold 80

# 합격 기준 미달 시 종료 코드 1 반환
if ! kubescape scan framework nsa --compliance-threshold 80; then
  echo "❌ 보안 검증 실패: 기준 미달"
  exit 1
fi
```

### 특정 컨트롤만 스캔

```bash
# 특정 컨트롤 스캔
kubescape scan control C-0018

# 여러 컨트롤 스캔
kubescape scan control C-0018,C-0003,C-0052
```

## 관련 문서

- [04-스캔-방법.md](./04-스캔-방법.md) - 스캔 방법 및 옵션 상세 가이드
- [05-프레임워크-컨트롤.md](./05-프레임워크-컨트롤.md) - 프레임워크 및 컨트롤 상세
- [08-실무-체크리스트.md](./08-실무-체크리스트.md) - 실무 적용 시 확인 사항
