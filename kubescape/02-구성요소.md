# Kubescape 구성 요소

Kubescape는 다음 주요 구성 요소로 이루어져 있습니다.

## 아키텍처 개요

### CLI 모드

```
┌─────────────────┐
│  Kubescape CLI  │  ← 사용자가 실행하는 명령어 도구
└────────┬────────┘
         │ kubectl/API
         ↓
┌─────────────────────────────────────────────┐
│         Kubernetes Cluster                  │
│                                             │
│  ┌──────────────────────────────────────┐  │
│  │   리소스 스캔 (Manifest, Cluster)    │  │
│  │   - 구성 오류 검사                    │  │
│  │   - 보안 설정 검사                    │  │
│  └──────────────────────────────────────┘  │
│                                             │
│  ┌──────────────────────────────────────┐  │
│  │   이미지 스캔 (Grype)                │  │
│  │   - 취약점 탐지                       │  │
│  └──────────────────────────────────────┘  │
└─────────────────────────────────────────────┘
         │
         ↓
┌─────────────────────────────────────────────┐
│         결과 리포트 (JSON, JUnit, HTML 등)  │
└─────────────────────────────────────────────┘
```

### Operator 모드

```
┌─────────────────────────────────────────────────────────────┐
│              Kubescape Operator                             │
│         지속적 스캔 및 모니터링                              │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ↓
┌─────────────────────────────────────────────────────────────┐
│         Kubernetes API Server                                │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │   CRDs (Custom Resource Definitions)                 │  │
│  │   - WorkloadConfigurationScanSummary                 │  │
│  │   - VulnerabilityManifestSummary                     │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │   Node Agent (eBPF 기반)                             │  │
│  │   - 런타임 relevancy 탐지                            │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 구성 요소 상세

### 1. CLI 유틸리티

커맨드라인에서 실행하는 스캔 도구입니다.

| 명령어 | 기능 | 설명 |
|--------|------|------|
| `kubescape scan` | 스캔 실행 | 프레임워크 또는 컨트롤 스캔 실행 |
| `kubescape scan framework` | 프레임워크 스캔 | NSA, CIS 등 프레임워크 기반 스캔 |
| `kubescape scan control` | 컨트롤 스캔 | 특정 컨트롤 스캔 실행 |
| `kubescape scan image` | 이미지 스캔 | 컨테이너 이미지 취약점 스캔 |
| `kubescape fix` | 자동 수정 | 스캔 결과 기반 자동 수정 제안 |

### 2. Operator (선택적)

클러스터 내부에서 지속적 스캔을 수행하는 Operator입니다.

| 역할 | 설명 |
|------|------|
| **지속적 스캔** | 주기적으로 클러스터 스캔 수행 |
| **이미지 스캔** | 새로 배포된 이미지 취약점 스캔 |
| **CRD 생성** | 스캔 결과를 CRD로 저장 |
| **Telemetry** | 메트릭 및 관측성 제공 |

### 3. 프레임워크 (Frameworks)

보안 기준을 정의하는 프레임워크들입니다.

| 프레임워크 | 설명 | 용도 |
|-----------|------|------|
| **NSA-CISA** | NSA-CISA Kubernetes 보안 가이드 | 미국 정부 기준 준수 검증 |
| **CIS** | CIS Kubernetes Benchmark | 산업 표준 보안 설정 검증 |
| **MITRE ATT&CK** | MITRE ATT&CK 프레임워크 | 공격 벡터 기반 검증 |
| **Custom** | 사용자 정의 프레임워크 | 조직별 보안 기준 정의 |

### 4. 컨트롤 (Controls)

개별 보안 검사 항목들입니다.

| 컨트롤 예시 | 설명 |
|------------|------|
| **C-0018** | Readiness probe 정의 여부 검사 |
| **C-0003** | Privileged 컨테이너 사용 금지 |
| **C-0052** | 이미지 취약점 검사 |

### 5. 취약점 스캔 (Vulnerability Scanning)

컨테이너 이미지 취약점을 스캔하는 기능입니다.

| 기능 | 설명 |
|------|------|
| **Grype 통합** | Grype 기반 취약점 스캔 |
| **SBOM 생성** | Software Bill of Materials 생성 |
| **Relevancy** | 실제 사용 중인 라이브러리 기반 필터링 |

### 6. 런타임 Relevancy

실제 사용 중인 라이브러리만 필터링하는 기능입니다.

| 기능 | 설명 |
|------|------|
| **Node Agent** | eBPF 기반 런타임 모니터링 |
| **라이브러리 탐지** | 실제 로드된 라이브러리 탐지 |
| **필터링** | 사용되지 않는 취약점 제외 |

## 스캔 실행 흐름

```
1. 사용자가 스캔 명령 실행
   └─ kubescape scan framework nsa

2. Kubernetes 리소스 수집
   └─ Manifest 또는 Live Cluster

3. 프레임워크/컨트롤 기반 검사
   └─ 각 컨트롤별 보안 검사 수행

4. 취약점 스캔 (선택적)
   └─ 이미지 취약점 스캔 (Grype)

5. 결과 리포트 생성
   └─ JSON, JUnit XML, HTML 등
```

## 관련 문서

- [03-설치및사용법.md](./03-설치및사용법.md) - 설치부터 실행까지 기본 워크플로우
- [04-스캔-방법.md](./04-스캔-방법.md) - 스캔 방법 및 옵션
- [05-프레임워크-컨트롤.md](./05-프레임워크-컨트롤.md) - 프레임워크 및 컨트롤 상세
